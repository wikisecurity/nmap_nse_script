# http-malware-host-1.nse

## Overview
`http-malware-host-1.nse` is an enhanced version of the original Nmap NSE script `http-malware-host.nse`, designed to **reduce false positives and ambiguous results**
observed in real-world environments.  
The original script relied on a single behavioral heuristic and often produced uncertain or misleading results on modern web infrastructures such as:  
- Sites that force global redirects (HTTP → HTTPS)
- Reverse proxies and load balancers
- CDN-backed services
- Strict virtual-host configurations

This updated version refines the detection logic and output format to provide **clearer, more conservative, and evidence-based results**.
   

## Design Goals
This script was developed with the following objectives:  
- Improve accuracy by reducing false positives found in the original script
- Preserve the original behavior-based detection concept
- Avoid payload inspection or malware signature matching
- Clearly distinguish between:
  - `CLEAN`
  - `SUSPECT`
  - `INCONCLUSIVE`
- Provide detailed evidence for every decision
- Work best with `-sV` (service detection) enabled

  
## Detection Logic (Behavior-Based)
The script performs two HTTP requests per detected web service:  
1. **Baseline check**
   - Requests a randomly generated, non-existent path
   - Observes whether the server returns a proper `404 Not Found`
2. **Probe check**
   - Requests a known legacy suspicious path:
     ```
     /ts/in.cgi?open2=1  
     ```
   - Observes redirect behavior (3xx responses and `Location` headers)
  

## Result Classification
| Result        | Meaning |
|--------------|--------|
| **CLEAN** | Both baseline and probe return `404`, indicating normal behavior |
| **SUSPECT** | Baseline returns `404`, but probe triggers redirect behavior |
| **INCONCLUSIVE** | Baseline does not return `404` (forced redirects, proxies, etc.) |

> This script does **not** claim confirmed compromise.  
> `SUSPECT` indicates behavior consistent with known compromise patterns.


## Usage
Recommended usage with service detection enabled:
```bash
nmap -sV -p 80,443,8080,8443 --script http-malware-host-1.nse <target>
```

### Example Output
``` text
$ nmap -sV -p 8081,8082,8083 --script http-malware-host-1.nse 127.0.0.1
Starting Nmap 7.80 ( https://nmap.org ) at 2026-01-19 17:03 KST
Nmap scan report for localhost (127.0.0.1)
Host is up (0.00016s latency).

PORT     STATE SERVICE VERSION
8081/tcp open  http    nginx 1.18.0 (Ubuntu)
| http-malware-host-1: RESULT: CLEAN
| REASON: Both baseline and probe returned 404
| EVIDENCE:
| - baseline_path: /nmapmalwarecheck-hul9h3g1it
| - baseline_status: 404
| - probe_path: /ts/in.cgi?open2=1
|_- probe_status: 404
|_http-server-header: nginx/1.18.0 (Ubuntu)

8082/tcp open  http    nginx 1.18.0 (Ubuntu)
| http-malware-host-1: RESULT: INCONCLUSIVE
| REASON: Baseline for unknown path did not return 404 (site forces redirects), unable to confidently check
| EVIDENCE:
| - baseline_path: /nmapmalwarecheck-w5xo7g9u3b
| - baseline_status: 302
| - baseline_location: http://127.0.0.1:8080/nmapmalwarecheck-w5xo7g9u3b
| - probe_path: /ts/in.cgi?open2=1
| - probe_status: 302
|_- probe_location: http://127.0.0.1:8080/ts/in.cgi?open2=1
|_http-server-header: nginx/1.18.0 (Ubuntu)

8083/tcp open  http    nginx 1.18.0 (Ubuntu)
| http-malware-host-1: RESULT: SUSPECT
| REASON: Baseline returned 404, but probe triggered redirect behavior
| EVIDENCE:
| - baseline_path: /nmapmalwarecheck-sgqmxajm5b
| - baseline_status: 404
| - probe_path: /ts/in.cgi?open2=1
| - probe_status: 302
|_- probe_location: http://evil-example.com/index.php
|_http-server-header: nginx/1.18.0 (Ubuntu)

Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
Nmap done: 1 IP address (1 host up) scanned in 6.28 seconds
```
  
## Differences from the Original Script
|  Aspect           |  Original `http-malware-host.nse`   | This `http-malware-host-1.nse`      |
| ----------------- | -------------------------------- | ------------------------------ |
|  Output            |  Binary (infected / clean)        |  CLEAN / SUSPECT / INCONCLUSIVE |
|  False positives   |  Frequent                         |  Significantly reduced          |
|  Redirect handling |  Limited                          |  Explicitly analyzed            |
|  Evidence          |  Minimal                          |  Detailed and explicit          |
|  Port handling     |  Implicit                         |  No hardcoded web ports         |
|  Intended use      |  Legacy environments              |  Modern web infrastructures     |
  
## Notes
- This script is behavior-based, not signature-based
- Results should be interpreted by a security analyst
- Designed for reconnaissance and triage, not confirmation
  
## License
- Same as Nmap — see: https://nmap.org/book/man-legal.html
